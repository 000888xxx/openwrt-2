<!--Copyright (C) 2019 Twinzo1 <1282055288@qq.com>-->

<%
local fs   = require "nixio.fs"
local http  = require "luci.http"
local ip  = require "luci.ip"
local sys = require "luci.sys"
local uci = require "luci.model.uci".cursor()
local mac_addr = {}
mac_addr.mac = uci:get_first("mac", "mac", "macc")
mac_addr.current_mac= uci:get("network", "wan", "macaddr")
mac_addr.current_mac_dev= uci:get("network", "wan_dev", "macaddr")
sys.call("uci set mac.@mac[0].login=%s" %{http.getenv("REMOTE_ADDR") or "?"})
sys.call("uci commit mac")
%>


<div class="cbi-value" id="<%=cbid%>"><label class="cbi-value-title" for="<%=cbid%>">当前Mac地址</label>	
<div class="cbi-value-field">
<script type="text/javascript">
	function realmac(){  //获取路由器mac地址
		var mac="<%=mac_addr.current_mac%>";
		var ma_c="<%=mac_addr.current_mac_dev%>";
		if (ma_c==""){
        		document.getElementById("mac").value = mac;
		}
		else{
        		document.getElementById("mac").value = ma_c;
		}	}

</script>
       <input type="text" id="mac" class="cbi-input-text" style="float: left; margin-right: 5px;" value=""/>
	   <body onload="realmac()">
</div>
</div>
<div class="cbi-value" ><label class="cbi-value-title" for="<%=cbid%>">Mac地址</label>	
<div class="cbi-value-field">
	<script type="text/javascript">
	function cmac(){ //获取登陆mac地址
		var clone = "<%=sys.exec('/etc/init.d/mac stop')%>";
		document.getElementById("<%=cbid%>c").value = clone;		
		}

	</script>

        <input type="text" name="<%=cbid%>c" id="<%=cbid%>c" class="cbi-input-text" data-type="macaddr" style="float: left; margin-right: 5px;" size="15" value="<%=mac_addr.mac%>"/>
	<input class="cbi-button cbi-input-button cbi-button-apply" type="button" id="clone" value="克隆" onclick="cmac()" />

<script type="text/javascript">
	function rmac() //生成随机mac地址
	{
    var addrArray = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f" ];
    var mac="";
	for (var i=1;i<=12;i++)
	{
		var j = Math.floor(Math.random()*15+0);
		if(i%2 == 0)
		{
			mac = mac + addrArray[j];
		}
		else
		{
			if(i == 1)
			{
				mac = mac + addrArray[j];
			}
			else
			{
				mac = mac + ":" +addrArray[j];
			}
		}
	}
    document.getElementById("<%=cbid%>c").value = mac;
	}	
</script>
	
	<input class="cbi-button cbi-input-button cbi-button-apply" type="button" id="random" value="随机" onclick="rmac()" />
</div>
</div>

